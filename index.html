<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>333 — Night Void (Monochrome Final Cut)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{
  --white: #fff;
  --black: #000;
  --muted: rgba(255,255,255,0.06);
  --glass: rgba(255,255,255,0.03);
  --grain: rgba(255,255,255,0.02);
  --pulse-speed: 0.22s;
}

/* RESET */
*{box-sizing:border-box;margin:0;padding:0;font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
html,body{height:100%;background:#000;color:var(--white);overflow:hidden}
body{display:flex;align-items:center;justify-content:center;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility}

/* hide system cursor on non-touch */
body.no-cursor{cursor:none}
a,button,input,select,textarea,[role="button"],.btn,.icon { cursor: none !important; }

/* BACKGROUND + LAYERS */
.bg{position:fixed;inset:0;width:100%;height:100%;object-fit:cover;z-index:0;filter:grayscale(1) brightness(.24) contrast(1.06);transition:transform .25s ease-out}
canvas#waves, canvas#particles,canvas#ghosts,canvas#fog,canvas#grain{position:fixed;inset:0;width:100%;height:100%;z-index:1;pointer-events:none}
.overlay{position:fixed;inset:0;background:linear-gradient(180deg,rgba(0,0,0,0.28),rgba(0,0,0,0.6));backdrop-filter:blur(2px);z-index:3;pointer-events:none}
.vignette{position:fixed;inset:0;z-index:45;pointer-events:none;background:radial-gradient(ellipse at center, rgba(0,0,0,0) 30%, rgba(0,0,0,0.5) 100%);mix-blend-mode:multiply;opacity:0.95}
.scanlines{position:fixed;inset:0;z-index:4;pointer-events:none;background:repeating-linear-gradient(to bottom,rgba(255,255,255,0.02)0px,rgba(255,255,255,0.02)1px,transparent 2px,transparent 3px);mix-blend-mode:overlay;opacity:0.12}

/* ENTER SCREEN */
#enterScreen{position:fixed;inset:0;z-index:60;display:flex;align-items:center;justify-content:center;flex-direction:column;background:#000}
#enterText{font-size:1.6rem;letter-spacing:6px;text-transform:uppercase;color:transparent;-webkit-text-stroke:0.9px rgba(255,255,255,0.92);cursor:pointer;padding:14px 30px;border-radius:999px;transition:transform .18s ease,opacity .5s ease;user-select:none;outline:none;position:relative;overflow:visible}
#enterText:hover{transform:scale(1.02)}
#enterText.glitch::after, #enterText.glitch::before{
  content: 'Enter the Void';
  position:absolute;left:0;right:0;text-align:center;
  clip-path:inset(0 0 0 0);
}
#enterScreen.fade{opacity:0;pointer-events:none;transition:opacity .9s ease}

/* CRT glitch / static */
@keyframes glitchShift {
  0% { transform:translateX(0) }
  20% { transform:translateX(-4px) }
  40% { transform:translateX(3px) }
  60% { transform:translateX(-2px) }
  80% { transform:translateX(2px) }
  100% { transform:translateX(0) }
}
.glitchWrap{position:relative;display:inline-block}
.glitchLine{
  position:absolute;left:0;right:0;height:2px;background:rgba(255,255,255,0.08);mix-blend-mode:screen;opacity:0;pointer-events:none;
}

/* CENTER content */
#center{position:relative;z-index:10;display:flex;align-items:center;flex-direction:column;gap:10px;pointer-events:auto;transform:translateY(20px);opacity:0;transition:transform 900ms cubic-bezier(.2,.9,.2,1),opacity 900ms ease}
#center.show{transform:none;opacity:1}

/* PFP/AURA */
.pfp{width:120px;height:120px;border-radius:999px;overflow:visible;position:relative;z-index:11}
.pfp img{width:120px;height:120px;border-radius:999px;object-fit:cover;display:block;filter:grayscale(1) contrast(1.04) brightness(0.95)}
.aura{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);pointer-events:none;width:420px;height:420px;border-radius:50%;z-index:9;mix-blend-mode:screen;filter:blur(30px);opacity:0.92;background:radial-gradient(circle at 50% 50%, rgba(255,255,255,0.12), rgba(255,255,255,0.02) 30%, rgba(255,255,255,0) 55%);transition:transform .25s linear,opacity .25s linear}

/* TITLE */
h1{font-size:2.6rem;letter-spacing:8px;margin-top:6px;background:linear-gradient(90deg,#fff,#e6e6e6,#fff);background-size:220% auto;-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:shimmer 3.2s linear infinite;z-index:11;transition:transform .18s ease}
@keyframes shimmer{0%{background-position:0% 50%}100%{background-position:200% 50%}}

/* ICONS */
.icon-row{display:flex;gap:18px;margin-top:14px;z-index:11}
.icon{width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.04);transition:transform .25s,box-shadow .25s;cursor:pointer;backdrop-filter:blur(4px)}
.icon img{width:22px;height:22px;filter:grayscale(1) brightness(.98);opacity:0.98}
.icon:hover{transform:translateY(-6px) scale(1.08);box-shadow:0 18px 42px rgba(255,255,255,0.06)}

/* VISUALIZER */
#visualizer{display:flex;gap:4px;margin-top:20px;align-items:flex-end;height:44px;z-index:11}
.vbar{width:6px;background:linear-gradient(to top,#fff,#e6e6e6);border-radius:3px;opacity:0.9;transform-origin:bottom center;transition:height .08s linear}

/* CONTROLS */
#controls{position:fixed;left:50%;transform:translateX(-50%);bottom:22px;z-index:40;display:flex;align-items:center;gap:10px;padding:8px 12px;border-radius:999px;background:rgba(0,0,0,0.28);backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,0.04)}
.btn{width:36px;height:36px;display:grid;place-items:center;border-radius:8px;background:rgba(255,255,255,0.03);cursor:pointer;transition:transform .12s,background .12s}
.btn:hover{transform:scale(1.06);background:rgba(255,255,255,0.06)}
.icon-white{width:18px;height:18px;filter:invert(1) grayscale(1) brightness(1.2)}

/* VOLUME */
input[type="range"]{width:140px;-webkit-appearance:none;background:transparent;margin-left:8px}
input[type=range]::-webkit-slider-runnable-track{height:5px;background:rgba(255,255,255,0.28);border-radius:999px}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:12px;height:12px;border-radius:50%;background:#fff;margin-top:-4px;box-shadow:0 0 12px rgba(255,255,255,0.7);cursor:pointer}

/* CUSTOM CURSOR DOT */
.cursor{
  position:fixed;width:14px;height:14px;border-radius:50%;
  background:rgba(255,255,255,0.95);
  box-shadow:0 0 18px rgba(255,255,255,0.85),0 0 40px rgba(255,255,255,0.06);
  pointer-events:none;z-index:9999;transform:translate(-50%,-50%) scale(1);opacity:0;transition:opacity .18s ease, transform .12s cubic-bezier(.2,.9,.2,1);
  will-change:transform,opacity;
}
.cursor.visible{opacity:1}
.cursor.hover{transform:translate(-50%,-50%) scale(1.85);box-shadow:0 0 36px rgba(255,255,255,0.95),0 0 86px rgba(255,255,255,0.08)}
.cursor.idle{transform:translate(-50%,-50%) scale(0.9);opacity:0.82}

/* cursor ripple */
.cursor-ripple { position: fixed; width: 18px; height: 18px; border-radius: 50%; pointer-events: none; transform: translate(-50%,-50%) scale(0.2); opacity: 0.28; box-shadow: 0 0 28px rgba(255,255,255,0.12); transition: transform 420ms cubic-bezier(.2,.9,.2,1), opacity 420ms ease; z-index:9998; }
.cursor-ripple.expand { transform: translate(-50%,-50%) scale(3.6); opacity: 0; }

/* ghost trail elements */
.ghost {
  position:fixed;width:22px;height:22px;border-radius:50%;background:rgba(255,255,255,0.08);pointer-events:none;z-index:9997;mix-blend-mode:screen;backdrop-filter:blur(0.8px);
  transform:translate(-50%,-50%) scale(1);transition:opacity .42s linear, transform .42s linear;
}

/* flick overlay */
.flicker{position:fixed;left:-10%;top:0;width:30%;height:100%;transform:skewX(-12deg);background:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,0.04),rgba(255,255,255,0));mix-blend-mode:screen;z-index:8;pointer-events:none;opacity:0;transition:opacity .12s ease}

/* film grain */
.grainOverlay{position:fixed;inset:0;z-index:50;pointer-events:none;background-image:linear-gradient(transparent,transparent);mix-blend-mode:overlay;opacity:0.22}
.grainOverlay canvas{width:100%;height:100%;display:block}

/* small copy popup */
.copy-popup{position:absolute;bottom:54px;left:50%;transform:translateX(-50%);background:rgba(255,255,255,0.95);color:#000;font-weight:700;font-size:12px;padding:6px 10px;border-radius:6px;opacity:0;pointer-events:none;transition:opacity .32s ease;backdrop-filter:blur(6px)}
.copy-popup.show{opacity:1}

/* responsive tweaks */
@media(max-width:520px){
 .pfp{width:96px;height:96px}.pfp img{width:96px;height:96px}
 h1{font-size:1.6rem}
 #visualizer{height:34px}
 #controls{bottom:14px}
}

/* cinematic cinematic micro-animations */
@keyframes cineEnter{
  0%{ opacity:0; transform: translateY(18px) scale(.98); filter:blur(6px) saturate(.85) }
  60%{ opacity:1; transform: translateY(-6px) scale(1.02); filter:blur(0px) saturate(1.06) }
  100%{ opacity:1; transform: translateY(0) scale(1); filter:none }
}
#center.show .pfp, #center.show h1, #center.show .icon-row { animation: cineEnter 820ms cubic-bezier(.2,.9,.2,1) both; will-change: transform, opacity, filter; }
#center.show .pfp { animation-delay: 120ms; } #center.show h1 { animation-delay: 220ms; } #center.show .icon-row { animation-delay: 350ms; }

/* camera drift */
body { animation: cameraDrift 28s ease-in-out infinite; }
@keyframes cameraDrift { 0%{ transform: translateY(0) } 50%{ transform: translateY(-6px) } 100%{ transform: translateY(0) } }

/* subtle glitch flicker on title */
@keyframes analogFlicker{
  0%{opacity:1}
  5%{opacity:.78; transform:translateY(1px)}
  9%{opacity:1}
  12%{opacity:.9; transform:translateY(-1px)}
  100%{opacity:1}
}
h1.flicker { animation: analogFlicker 2.8s infinite ease-in-out }

/* ripple click visual */
.ripple-click {
  position:fixed; border-radius:50%; pointer-events:none; z-index:9996; mix-blend-mode:screen;
  background: radial-gradient(circle, rgba(255,255,255,0.16) 0%, rgba(255,255,255,0.04) 35%, rgba(255,255,255,0) 60%);
  transform: translate(-50%,-50%) scale(0.4); opacity:0; transition: transform 420ms ease, opacity 420ms ease;
}
.ripple-click.show { transform: translate(-50%,-50%) scale(3.2); opacity:0; transition: transform 700ms cubic-bezier(.2,.9,.2,1), opacity 700ms ease; }

/* subtle hover distortion (pseudo) */
.icon.hover-distort { filter: contrast(1.02) brightness(1.02) saturate(0) }

</style>
</head>
<body>
  <!-- ENTER -->
  <div id="enterScreen" aria-hidden="false">
    <div id="enterText" class="glitchWrap" tabindex="0" role="button" aria-label="Enter the Void">
      <span style="position:relative;z-index:2">Enter the Void</span>
      <div class="glitchLine" style="top:12%;"></div>
      <div class="glitchLine" style="top:44%;"></div>
      <div class="glitchLine" style="top:72%;"></div>
    </div>
  </div>

  <!-- BACKGROUNDS & CANVASES -->
  <img class="bg" alt="night city" src="https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExbjQ0YTB6YzBlNnh2NHhzY3lzbjR0MXE1Nm5meXIzbzZxdmF6ZW84cSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/uvfaWDpUbfUvAi5HQe/giphy.gif"/>
  <canvas id="waves"></canvas>
  <canvas id="particles"></canvas>
  <canvas id="ghosts"></canvas>
  <canvas id="fog"></canvas>
  <canvas id="grain"></canvas>

  <div class="overlay"></div>
  <div class="vignette"></div>
  <div class="scanlines"></div>
  <div class="flicker" id="flick"></div>

  <!-- CENTER -->
  <div id="center" aria-hidden="true">
    <div class="aura" id="aura"></div>
    <div class="pfp" id="pfp"><img alt="pfp" src="https://i.imgur.com/OJeD12w.jpeg"/></div>
    <h1 id="title" class="flicker">333</h1>
    <div class="icon-row" id="icons">
      <div class="icon discord-copy" title="Copy Discord"><img alt="discord" src="https://cdn-icons-png.flaticon.com/512/2111/2111370.png"/><div class="copy-popup" id="copyPopup">Copied</div></div>
      <a class="icon" href="https://t.me/lntersect" rel="noreferrer" target="_blank" title="Telegram"><img alt="telegram" src="https://cdn-icons-png.flaticon.com/512/2111/2111646.png"/></a>
    </div>

    <div id="visualizer" aria-hidden="true">
      <!-- 20 bars -->
      <div class="vbar" style="height:8px"></div><div class="vbar" style="height:10px"></div><div class="vbar" style="height:7px"></div><div class="vbar" style="height:9px"></div>
      <div class="vbar" style="height:11px"></div><div class="vbar" style="height:8px"></div><div class="vbar" style="height:7px"></div><div class="vbar" style="height:10px"></div>
      <div class="vbar" style="height:9px"></div><div class="vbar" style="height:8px"></div><div class="vbar" style="height:7px"></div><div class="vbar" style="height:10px"></div>
      <div class="vbar" style="height:9px"></div><div class="vbar" style="height:8px"></div><div class="vbar" style="height:11px"></div><div class="vbar" style="height:7px"></div>
      <div class="vbar" style="height:8px"></div><div class="vbar" style="height:9px"></div><div class="vbar" style="height:7px"></div><div class="vbar" style="height:8px"></div>
    </div>
  </div>

  <!-- CONTROLS (hidden until enter) -->
  <div id="controls" aria-hidden="true" style="display:none">
    <button aria-label="Play/Pause" aria-pressed="false" class="btn" id="playBtn" title="Play/Pause">
      <svg fill="none" height="18" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.4" viewBox="0 0 24 24" width="18"><path d="M5 3v18l15-9L5 3z"></path></svg>
    </button>
    <button aria-label="Mute/Unmute" aria-pressed="false" class="btn" id="muteBtn" title="Mute/Unmute">
      <svg fill="none" height="14" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.4" viewBox="0 0 24 24" width="14"><path d="M11 5L6 9H3v6h3l5 4V5z"></path><path d="M19 9a4 4 0 010 6"></path></svg>
    </button>
    <input aria-label="Volume" id="vol" max="100" min="0" type="range" value="70"/>
  </div>

  <!-- cursor helpers -->
  <div class="cursor" id="cursorEl"></div>

  <!-- grain overlay canvas container -->
  <div class="grainOverlay" id="grainOverlay"><canvas id="grainCanvas"></canvas></div>

  <!-- hidden host for youtube -->
  <div id="ytHost" style="width:1px;height:1px;overflow:hidden;position:fixed;left:-9999px;top:-9999px;"></div>

<script>
/* =========================
   Utilities & DOM refs
   ========================= */
const enterScreen = document.getElementById('enterScreen');
const enterText = document.getElementById('enterText');
const center = document.getElementById('center');
const bg = document.querySelector('.bg');
const cursorEl = document.getElementById('cursorEl');
const controls = document.getElementById('controls');
const playBtn = document.getElementById('playBtn');
const muteBtn = document.getElementById('muteBtn');
const volRange = document.getElementById('vol');
const visualizer = document.getElementById('visualizer');
const flick = document.getElementById('flick');
const aura = document.getElementById('aura');
const title = document.getElementById('title');
const grainCanvas = document.getElementById('grainCanvas');
const grainOverlay = document.getElementById('grainOverlay');

let ytPlayer = null, isPlaying=false, isMuted=false;

/* =========== YouTube API (lazy) =========== */
function loadYouTubeAPI(cb){
  if(window.YT && window.YT.Player){ cb(); return; }
  const s = document.createElement('script'); s.src = "https://www.youtube.com/iframe_api"; document.head.appendChild(s);
  window.onYouTubeIframeAPIReady = cb;
}
function createYTPlayer(){
  const host = document.getElementById('ytHost'); const div = document.createElement('div'); div.id='ytPlayerEl'; host.appendChild(div);
  ytPlayer = new YT.Player('ytPlayerEl', {
    height:'1',width:'1',videoId:'OAyixxm4yXw',
    playerVars:{autoplay:1,controls:0,loop:1,playlist:'OAyixxm4yXw',rel:0,modestbranding:1},
    events:{
      onReady:(e)=>{ const v=parseInt(volRange.value,10); ytPlayer.setVolume(v); ytPlayer.playVideo(); isPlaying=true; updatePlayIcon(); showControls(); },
      onStateChange:(ev)=>{ if(ev.data===YT.PlayerState.ENDED) ytPlayer.playVideo(); }
    }
  });
}

/* =========== Enter flow & effects =========== */
enterText.addEventListener('click', startExperience);
enterText.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') startExperience(); });

function startExperience(){
  // glitch pulse on enter
  playGlitch(5);
  // ripple & particles
  createEnterBurst(window.innerWidth/2, window.innerHeight/2);
  // hide enter
  enterScreen.classList.add('fade'); setTimeout(()=> enterScreen.style.display='none',900);
  // reveal center
  center.classList.add('show'); center.removeAttribute('aria-hidden');
  // flick
  flick.style.opacity = 0.22; setTimeout(()=> flick.style.opacity = 0, 260);
  // canvases
  initAllCanvases();
  enableAuraPulse();
  // load YT after gesture
  loadYouTubeAPI(()=> createYTPlayer());
  // show controls
  showControls();
}

/* small glitch effect on enter title */
function playGlitch(times=3){
  const el = document.getElementById('enterText');
  let i=0;
  function one(){
    el.style.opacity=0.96; el.style.transform='translateX(-1px)'; setTimeout(()=>{ el.style.transform='translateX(1px)'; el.style.opacity=1; },70);
    if(++i<times) setTimeout(one,90+Math.random()*120);
  }
  one();
}

/* show controls */
function showControls(){
  controls.style.display='flex'; controls.setAttribute('aria-hidden','false');
}
function updatePlayIcon(){
  playBtn.innerHTML = isPlaying
    ? `<svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="5" width="4" height="14" rx="1"/><rect x="14" y="5" width="4" height="14" rx="1"/></svg>`
    : `<svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="#fff" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"><path d="M5 3v18l15-9L5 3z"/></svg>`;
  playBtn.setAttribute('aria-pressed', String(isPlaying));
}

/* controls */
playBtn.addEventListener('click', ()=>{
  if(!ytPlayer) return;
  if(isPlaying){ ytPlayer.pauseVideo(); isPlaying=false; } else { ytPlayer.playVideo(); isPlaying=true; }
  updatePlayIcon();
});
muteBtn.addEventListener('click', ()=>{
  if(!ytPlayer) return;
  if(isMuted){ ytPlayer.unMute(); isMuted=false; muteBtn.setAttribute('aria-pressed','false'); }
  else { ytPlayer.mute(); isMuted=true; muteBtn.setAttribute('aria-pressed','true'); }
});
volRange.addEventListener('input', ()=>{ const v = parseInt(volRange.value,10) || 0; if(ytPlayer) ytPlayer.setVolume(v); });

/* space toggles */
document.addEventListener('keydown', (e)=>{ if(e.code==='Space'){ e.preventDefault(); if(ytPlayer){ if(isPlaying){ ytPlayer.pauseVideo(); isPlaying=false; } else { ytPlayer.playVideo(); isPlaying=true; } updatePlayIcon(); } }});

/* =========== Visualizer (fake energy) =========== */
const vbars = Array.from(document.querySelectorAll('.vbar'));
const VCOUNT = vbars.length;
let vizStart=0;
function fakeEnergy(t){
  const beat = 0.8 + 0.45 * Math.abs(Math.sin(t*0.004 + 0.02));
  const rhythm = 0.5 + 0.45 * Math.abs(Math.sin(t*0.011 + 0.7));
  const bursts = (Math.sin(t*0.02) > 0.82) ? (0.4 + Math.random()*0.9) : (0.02*Math.random());
  return Math.min(1, (0.55*beat + 0.35*rhythm + 0.9*bursts) * (0.95 + 0.2*Math.random()));
}
function stepViz(t){
  if(!vizStart) vizStart=t;
  const elapsed=t-vizStart;
  const E=fakeEnergy(elapsed);
  for(let i=0;i<VCOUNT;i++){
    const idx=i/VCOUNT;
    const local = E*(0.6+0.6*(1-idx)) + 0.12*Math.sin(elapsed*0.007*(1+idx*2)+i);
    const transient = (Math.random()<0.02) ? (0.2+Math.random()*0.8) : 0;
    const val=Math.min(1, Math.max(0, local + transient));
    const px=Math.max(6, Math.round(val*(56 - idx*16)));
    vbars[i].style.height = px + 'px';
    vbars[i].style.opacity = 0.36 + (val*0.64);
  }
  // title subtle scale
  const strongest = Math.max(...Array.from(vbars).map(b => parseFloat(b.style.height)));
  const scale = 1 + (strongest/140);
  title.style.transform = `scale(${scale})`;
  // aura intensity
  aura.style.opacity = 0.6 + Math.min(0.34, E*0.8);
}

/* =========== Cursor & Ghosts =========== */
const HIDE_IDLE_MS = 900;
let idleTimer = null;
let isTouch = (('ontouchstart' in window) || navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0);
if(!isTouch){ document.body.classList.add('no-cursor'); } else { cursorEl.style.display='none'; document.body.classList.remove('no-cursor'); }

function showCursorImmediate(){ cursorEl.classList.add('visible'); cursorEl.classList.remove('idle'); clearTimeout(idleTimer); idleTimer = setTimeout(()=>{ cursorEl.classList.remove('visible'); cursorEl.classList.remove('hover'); }, HIDE_IDLE_MS); }
function setCursorPos(x,y){ cursorEl.style.left = x + 'px'; cursorEl.style.top = y + 'px'; }
function updateHoverState(e){
  const el = document.elementFromPoint(e.clientX, e.clientY);
  if(!el) return false;
  const interactive = el.closest && (el.closest('a,button,input,select,textarea,[role="button"],.btn,.icon'));
  if(interactive) cursorEl.classList.add('hover'); else cursorEl.classList.remove('hover');
}

/* ghost trail pool */
const ghostPool = [];
for(let i=0;i<6;i++){
  const g = document.createElement('div'); g.className='ghost'; document.body.appendChild(g); ghostPool.push(g);
}

/* ripple click element pool */
const ripplePool = [];
for(let i=0;i<4;i++){
  const r = document.createElement('div'); r.className='ripple-click'; document.body.appendChild(r); ripplePool.push(r);
}

/* particle burst on enter */
const burstParticles = [];
function createEnterBurst(cx,cy){
  const cnt = 58;
  for(let i=0;i<cnt;i++){
    const a = Math.random()*Math.PI*2;
    const s = 2 + Math.random()*4;
    burstParticles.push({x:cx,y:cy, vx:Math.cos(a)*(2+Math.random()*6), vy:Math.sin(a)*(2+Math.random()*6), r: 0.6+Math.random()*2, life: 700 + Math.random()*900, born: performance.now()});
  }
}

/* show click ripple */
function doClickRipple(x,y){
  const r = ripplePool.shift(); ripplePool.push(r);
  r.style.left = x + 'px'; r.style.top = y + 'px'; r.style.width = '12px'; r.style.height = '12px';
  r.classList.add('show');
  setTimeout(()=> r.classList.remove('show'),700);
}

/* pointer handlers */
let lastPos = {x: window.innerWidth/2, y: window.innerHeight/2}, speed=0;
window.addEventListener('pointermove', (e)=>{
  if(isTouch) return;
  showCursorImmediate();
  setCursorPos(e.clientX,e.clientY);
  updateHoverState(e);
  // ghost trail: recycle
  const g = ghostPool.shift(); ghostPool.push(g);
  g.style.left = e.clientX + 'px'; g.style.top = e.clientY + 'px';
  g.style.opacity = '0.32'; g.style.transform = 'translate(-50%,-50%) scale(1)';
  // small size random
  g.style.width = (12 + Math.random()*18) + 'px'; g.style.height = g.style.width;
  // fade after short delay
  setTimeout(()=>{ g.style.opacity = '0'; g.style.transform = 'translate(-50%,-50%) scale(1.8)'; }, 60);
  // speed (for motion blur-ish effect)
  const dx = e.clientX - lastPos.x, dy = e.clientY - lastPos.y;
  speed = Math.sqrt(dx*dx+dy*dy);
  lastPos.x = e.clientX; lastPos.y = e.clientY;
});

/* pointer down/up */
window.addEventListener('pointerdown', (e)=>{
  if(isTouch) return;
  cursorEl.style.transform = 'translate(-50%,-50%) scale(0.9)';
  // ripple
  doClickRipple(e.clientX, e.clientY);
});
window.addEventListener('pointerup', (e)=>{
  if(isTouch) return;
  cursorEl.style.transform = cursorEl.classList.contains('hover') ? 'translate(-50%,-50%) scale(1.85)' : 'translate(-50%,-50%) scale(1)';
});

/* pointerover/out for interactive elements */
document.addEventListener('pointerover', (e)=>{
  if(isTouch) return;
  const tgt = e.target;
  if(tgt && tgt.closest && tgt.closest('a,button,input,select,textarea,[role="button"],.btn,.icon')){
    cursorEl.classList.add('hover'); showCursorImmediate();
    const ic = tgt.closest('.icon'); if(ic) ic.classList.add('hover-distort');
  }
});
document.addEventListener('pointerout', (e)=>{
  if(isTouch) return;
  const tgt = e.target;
  if(tgt && tgt.closest && tgt.closest('a,button,input,select,textarea,[role="button"],.btn,.icon')){
    cursorEl.classList.remove('hover');
    const ic = tgt.closest('.icon'); if(ic) ic.classList.remove('hover-distort');
  }
});

/* =========== CANVASES: waves, particles, ghosts, fog, grain =========== */
const waves = document.getElementById('waves');
const particles = document.getElementById('particles');
const ghosts = document.getElementById('ghosts');
const fog = document.getElementById('fog');
const grain = document.getElementById('grain');

const wctx = waves.getContext('2d');
const pctx = particles.getContext('2d');
const gctx = ghosts.getContext('2d');
const fctx = fog.getContext('2d');
const grctx = grain.getContext('2d');

let W = innerWidth, H = innerHeight;
function resizeAll(){ W = innerWidth; H = innerHeight; [waves,particles,ghosts,fog,grain,grainCanvas].forEach(c=>{ c.width = W; c.height = H; }); }
window.addEventListener('resize', resizeAll); resizeAll();

/* waves */
let wavesArr = [];
for(let i=0;i<6;i++) wavesArr.push({y: H*0.2 + i*(H*0.12), amp: 20 + Math.random()*36, speed: 0.0006 + Math.random()*0.0012, phase: Math.random()*Math.PI*2 });
function drawWaves(t){
  wctx.clearRect(0,0,W,H); wctx.globalCompositeOperation='lighter';
  for(let i=0;i<wavesArr.length;i++){
    const w=wavesArr[i]; w.phase += w.speed*(t%10000);
    const grad = wctx.createLinearGradient(0,w.y-80,0,w.y+80);
    grad.addColorStop(0,'rgba(255,255,255,0)');
    grad.addColorStop(0.4,'rgba(255,255,255,0.02)');
    grad.addColorStop(1,'rgba(255,255,255,0)');
    wctx.fillStyle = grad; wctx.beginPath(); wctx.moveTo(0,H);
    for(let x=0;x<=W;x+=24){
      const y = w.y + Math.sin((x*0.006)+(w.phase*0.005))*w.amp*Math.sin(t*0.0005 + i);
      wctx.lineTo(x,y);
    }
    wctx.lineTo(W,H); wctx.closePath(); wctx.fill();
  }
  wctx.globalCompositeOperation='source-over';
}

/* small floating particles (soft dust) */
let smalls = [];
for(let i=0;i<110;i++) smalls.push({ x: Math.random()*W, y: Math.random()*H, r: Math.random()*1.6, vy: 0.2+Math.random()*0.7 });

function drawParticles(){
  pctx.clearRect(0,0,W,H); pctx.fillStyle='rgba(255,255,255,0.12)';
  for(let p of smalls){
    pctx.beginPath(); pctx.arc(p.x,p.y,p.r,0,Math.PI*2); pctx.fill();
    p.y -= p.vy * 0.25; if(p.y < -10){ p.y = H + 10; p.x = Math.random()*W; }
  }
}

/* burst particles (enter) */
function drawBursts(now){
  // clean expired & draw
  for(let i=burstParticles.length-1;i>=0;i--){
    const b = burstParticles[i];
    const age = now - b.born;
    if(age > b.life){ burstParticles.splice(i,1); continue; }
    const lifeT = 1 - (age / b.life);
    pctx.beginPath();
    pctx.fillStyle = `rgba(255,255,255,${0.16 * lifeT})`;
    pctx.arc(b.x, b.y, b.r * (1 + (1-lifeT)*1.6), 0, Math.PI*2);
    pctx.fill();
    // motion
    b.x += b.vx * 0.9; b.y += b.vy * 0.9;
    // slight drag
    b.vx *= 0.98; b.vy *= 0.98;
  }
}

/* ghost canvas for subtle motion echoes */
let ghostDots = [];
for(let i=0;i<80;i++) ghostDots.push({x:Math.random()*W, y:Math.random()*H, r:0.6+Math.random()*1.6, a: Math.random()*0.18});
function drawGhosts(){
  gctx.clearRect(0,0,W,H); gctx.fillStyle = 'rgba(255,255,255,0.06)';
  for(let d of ghostDots){
    gctx.beginPath(); gctx.arc(d.x,d.y,d.r,0,Math.PI*2); gctx.fill();
    d.x += (Math.random()-0.5)*0.6; d.y += (Math.random()-0.5)*0.6;
    if(d.x<0)d.x=W; if(d.x>W)d.x=0; if(d.y<0)d.y=H; if(d.y>H)d.y=0;
  }
}

/* fog blobs */
let fogBlobs=[];
for(let i=0;i<8;i++) fogBlobs.push({ x: Math.random()*W, y: Math.random()*H, s:(W/2)*(0.08+Math.random()*0.6), vx:(Math.random()-0.5)*0.06, vy:(Math.random()-0.5)*0.03, alpha:0.02+Math.random()*0.06, phase:Math.random()*Math.PI*2 });
function drawFog(t){
  fctx.clearRect(0,0,W,H);
  for(let b of fogBlobs){
    b.x += b.vx * Math.cos(t*0.0007 + b.phase) * 0.8;
    b.y += b.vy * Math.sin(t*0.0004 + b.phase) * 0.8;
    const g = fctx.createRadialGradient(b.x,b.y,0,b.x,b.y,b.s);
    g.addColorStop(0, `rgba(255,255,255,${b.alpha})`);
    g.addColorStop(0.35, `rgba(255,255,255,${b.alpha*0.45})`);
    g.addColorStop(1, 'rgba(255,255,255,0)');
    fctx.fillStyle = g;
    fctx.beginPath(); fctx.arc(b.x,b.y,b.s,0,Math.PI*2); fctx.fill();
  }
}

/* grain draw */
function drawGrain(){
  grctx.clearRect(0,0,W,H); grctx.fillStyle = 'rgba(255,255,255,0.02)';
  const dots = Math.round(W*H/9000);
  for(let i=0;i<dots;i++){ const x= Math.random()*W, y=Math.random()*H; grctx.fillRect(x,y,1,1); }
}

/* grain overlay canvas for subtle motion */
const govctx = grainCanvas.getContext('2d');
function drawOverlayGrain(){
  govctx.clearRect(0,0,W,H); govctx.fillStyle='rgba(255,255,255,0.02)';
  const dots = Math.round(W*H/16000);
  for(let i=0;i<dots;i++){ const x = Math.random()*W, y = Math.random()*H; govctx.fillRect(x,y,1,1); }
}

/* framerate loop */
let last = performance.now();
function frame(t){
  const dt = t - last; last = t;
  drawWaves(t);
  drawParticles();
  drawBursts(t);
  drawGhosts();
  drawFog(t);
  drawGrain();
  drawOverlayGrain();
  stepViz(t);

  // occasional flick
  if(Math.random() < 0.0025){ flick.style.opacity = 0.28; setTimeout(()=> flick.style.opacity = 0, 120 + Math.random()*240); }

  // draw burst particle motion slight trail on DOM ghosts
  // reuse burstParticles to create subtle "afterimage" nodes if fast movement
  requestAnimationFrame(frame);
}

/* start loop only after init */
function initAllCanvases(){ if(!window.__canvasStarted){ window.__canvasStarted = true; requestAnimationFrame(frame); } }

/* expose debug */
window.__VOID = { createEnterBurst };

/* =========== Parallax (depth) =========== */
let tX=0,tY=0,cX=0,cY=0;
const strengthRotate = 10;
const depthBg = 0.12, depthFog = 0.34, depthAura = 0.46;
window.addEventListener('mousemove', (e)=>{ const x=(e.clientX/window.innerWidth-0.5)*2; const y=(e.clientY/window.innerHeight-0.5)*2; tX=x; tY=y; });
function animate3DParallax(){
  cX += (tX - cX) * 0.08; cY += (tY - cY) * 0.08;
  const bgEl = document.querySelector('.bg'); const fogEl = document.getElementById('fog'); const auraEl = document.getElementById('aura'); const centerEl = document.getElementById('center');
  const rotateX = cY * -strengthRotate; const rotateY = cX * strengthRotate;
  if(bgEl) bgEl.style.transform = `translate(${cX * 60 * depthBg}px, ${cY * 60 * depthBg}px) scale(1.06) rotateY(${rotateY*0.4}deg) rotateX(${rotateX*0.4}deg)`;
  if(fogEl) fogEl.style.transform = `translate(${cX * 80 * depthFog}px, ${cY * 80 * depthFog}px) rotateY(${rotateY*0.6}deg) rotateX(${rotateX*0.6}deg)`;
  if(auraEl) auraEl.style.transform = `translate(calc(-50% + ${cX * 100 * depthAura}px), calc(-50% + ${cY * 100 * depthAura}px)) rotateY(${rotateY*0.8}deg) rotateX(${rotateX*0.8}deg)`;
  if(centerEl) centerEl.style.transform = 'none';
  requestAnimationFrame(animate3DParallax);
}
animate3DParallax();

/* =========== Aura pulse (monochrome) =========== */
function enableAuraPulse(){
  aura.style.animation = 'auraPulse 6s ease-in-out infinite';
  aura.style.opacity = 0.86;
}
const auraEl = document.getElementById('aura');
auraEl && (auraEl.style.transition = 'transform 420ms linear, opacity 280ms ease');

/* aura rotate keyframes injected via JS to keep file single */
const styleTag = document.createElement('style');
styleTag.textContent = `
@keyframes auraPulse{
  0%{ transform: translate(-50%,-50%) scale(0.98); opacity:0.82 }
  50%{ transform: translate(-50%,-50%) scale(1.04); opacity:0.96 }
  100%{ transform: translate(-50%,-50%) scale(0.98); opacity:0.82 }
}
@keyframes auraRotate { 0%{ transform: translate(-50%,-50%) rotate(0deg) } 100%{ transform: translate(-50%,-50%) rotate(360deg) } }
`;
document.head.appendChild(styleTag);
auraEl && auraEl.classList.add('aura-rotate');

/* tie aura to visualizer energy slightly */
function sampleEnergy(){
  const bars = Array.from(document.querySelectorAll('.vbar'));
  if(!bars.length) return 0;
  const vals = bars.map(b=> parseFloat(b.style.height || 6));
  const max = Math.max(...vals);
  const energy = Math.min(1, Math.max(0, (max - 6) / 52));
  return energy;
}
let smooth = 0;
(function auraTick(){
  const target = sampleEnergy();
  smooth += (target - smooth) * 0.18;
  const op = 0.6 + smooth * 0.86;
  const sc = 1 + smooth * 0.04;
  auraEl.style.opacity = op;
  auraEl.style.transform = `translate(calc(-50% + ${cX*100}px), calc(-50% + ${cY*100}px)) rotate(${(Date.now()%36000)/100}deg) scale(${sc})`;
  auraEl.style.filter = `blur(${28 - smooth*6}px) saturate(${1})`;
  requestAnimationFrame(auraTick);
})();

/* subtle title glow */
(function titleGlow(){
  const e = sampleEnergy();
  title.style.textShadow = `0 ${(4 + e*18)|0}px ${8 + e*36}px rgba(255,255,255,${0.04 + e*0.28})`;
  requestAnimationFrame(titleGlow);
})();

/* particle pulse nudges */
let lastPulse = 0;
(function pulseParticles(){
  const e = sampleEnergy();
  if(e > 0.48 && Date.now() - lastPulse > 160){
    for(let p of smalls) p.vy += 0.02 * (0.6 + Math.random()*0.8);
    lastPulse = Date.now();
  }
  requestAnimationFrame(pulseParticles);
})();

/* =======================
   Misc: bursts + interactions
   ======================= */
function update(){
  const now = performance.now();
  // burstParticles handled in drawBursts
  requestAnimationFrame(update);
}
requestAnimationFrame(update);

/* initial warm up of grain canvas */
(function initGrain(){ drawGrain(); drawOverlayGrain(); })();

/* start main frame loop when ready */
initAllCanvases();

/* start DOM visible cursor */
cursorEl.classList.add('visible');

/* click ripple for enter screen */
enterText.addEventListener('pointerdown', (e)=>{
  playGlitch(2);
  const rect = enterText.getBoundingClientRect();
  const cx = rect.left + rect.width/2;
  const cy = rect.top + rect.height/2;
  createEnterBurst(cx, cy);
});

/* click anywhere ripple */
window.addEventListener('pointerdown', (e)=>{
  doClickRipple(e.clientX, e.clientY);
});

/* =========== Discord copy handler =========== */
const discordIcon = document.querySelector('.discord-copy');
const popup = document.getElementById('copyPopup');
if(discordIcon){
  discordIcon.addEventListener('click', ()=>{
    navigator.clipboard.writeText('l.ung').then(()=>{ popup.classList.add('show'); setTimeout(()=> popup.classList.remove('show'), 700); });
  });
}

/* Prevent accidental image drag */
document.querySelectorAll('img').forEach(img => { img.ondragstart = () => false; });

/* small warm-friendly console message */
console.log('%c Night Void — Monochrome Final Cut loaded', 'color: #fff; background: #000; padding:6px 8px; border-radius:6px');

</script>
</body>
</html>
